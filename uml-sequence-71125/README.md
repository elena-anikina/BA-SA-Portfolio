# Диаграмма последовательности: Авторизация пользователя по JWT токену

## Назначение диаграммы
Диаграмма описывает процесс аутентификации и авторизации пользователя в системе с использованием JWT (JSON Web Token) токенов, включая как успешный сценарий, так и обработку ошибок.

## Участники системы

| Участник | Роль и ответственность |
|----------|-----------------------|
| **User** (Пользователь) | Инициатор процесса, предоставляет учетные данные |
| **UI Frontend** | Клиентский интерфейс, валидация ввода, управление сессией |
| **Service Proxy** | Маршрутизация запросов, промежуточный слой |
| **Service Backend** | Бизнес-логика, генерация токенов, проверка прав |
| **DB** (База данных) | Хранение пользовательских данных, логирование |

## Общая последовательность (шаги 1-12)

### Фаза 1: Первичная аутентификация
1. **User → UI Frontend**: Нажатие кнопки "Войти"
2. **UI Frontend**: Проведение валидации введенных данных
3. **UI Frontend → Service Proxy**: POST /login {login, password}
4. **Service Proxy → Service Backend**: POST /login {login, password}

### Фаза 2: Проверка учетных данных
5. **Service Backend → DB**: SQL-запрос (авторизация и аутентификация)
6. **DB → Service Backend**: Ответ (id пользователя, права доступа)
7. **Service Backend**: Генерация JWT токена
8. **Service Backend → DB**: SQL запрос для логирования операции

### Фаза 3: Возврат токена
9. **Service Backend → Service Proxy**: JWT токен
10. **Service Proxy → UI Frontend**: JWT токен

### Фаза 4: Доступ к защищенным ресурсам
11. **UI Frontend → Service Proxy**: GET /something с заголовком Authorization: JWT...
12. **Service Proxy → Service Backend**: GET /something с заголовком Authorization: JWT...

## Альтернативные сценарии

### ✅ Сценарий A: Успешная авторизация (валидный токен)

13. **Service Backend**: Проверка подписи JWT токена
14. **Service Backend**: Получение данных из JWT токена
15. **Service Backend → DB**: SQL-запрос на поиск данных
16. **DB → Service Backend**: Данные
17. **Service Backend**: Проверка данных
18. **Service Backend → Service Proxy**: Успешный статус 200 OK + JWT токен + Данные
19. **Service Proxy → UI Frontend**: Успешный статус 200 OK + JWT токен + Данные
20. **UI Frontend → User**: Вывод данных пользователю

### ❌ Сценарий B: Неуспешная авторизация (невалидный токен)

13. **Service Backend**: Проверка подписи JWT токена → ОШИБКА
21. **Service Backend → Service Proxy**: Ошибка 401 Unauthorized
22. **Service Proxy → UI Frontend**: Ошибка 401 Unauthorized  
23. **UI Frontend → User**: Сообщение об ошибке аутентификации

## Ключевые особенности системы

### Безопасность
- **JWT токены** для stateless аутентификации
- **Проверка подписи** токена на стороне backend
- **Автоматическое обновление** токена при успешных запросах
- **HTTP-коды ошибок** для различных сценариев

### Архитектурные решения
- **Service Proxy** для централизованной маршрутизации
- **Разделение ответственности** между компонентами
- **Логирование** операций аутентификации
- **Валидация** на клиенте и сервере

### Потоки данных
- Учетные данные передаются только при первоначальной аутентификации
- JWT токен используется для последующих запросов
- Данные пользователя извлекаются на основе информации в токене

## Преимущества подхода
- **Масштабируемость**: Stateless архитектура
- **Безопасность**: Токены вместо сессий
- **Производительность**: Минимальные запросы к БД после аутентификации
- **Универсальность**: Единый механизм для разных клиентов

---

*Диаграмма демонстрирует полный цикл работы системы аутентификации и может служить основой для технической документации и обсуждения с командой разработки.*
